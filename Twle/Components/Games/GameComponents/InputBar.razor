<div class="centered-input">
    <input class="styled-input-bar" @bind="Sufix" @oninput="UpdateItemsList" @onkeypress="OnKeyPress" @onclick="ChangeListVisibility" @onblur="HideList"/>
    <div class="hide-scrollbar @(string.IsNullOrWhiteSpace(Sufix) ? (_showList ? "show" : "") : "show")">
        <ul class="no-bullets">
            @if (!string.IsNullOrWhiteSpace(Sufix))
            {
                foreach (var item in StreamerProfile)
                {
                    if (item.IsVisible)
                    {
                        <li @onclick="() => OnClick(item.Id)">
                            <div style="display: flex; align-items: center;">
                                <img src="@item.ImageUrl" style="width: 50px; height: 50px; margin-right: 10px;" alt="Profile avatar"/>
                                @item.Name
                            </div>
                        </li>
                    }
                }
            }
            else
            {
                foreach (var item in StreamerProfile)
                {

                    {
                        <li @onclick="() => OnClick(item.Id)">
                            <div style="display: flex; align-items: center;">
                                <img src="@item.ImageUrl" style="width: 50px; height: 50px; margin-right: 10px;" alt="Profile avatar"/>
                                @item.Name
                            </div>
                        </li>
                    }
                }
            }
        </ul>
    </div>
</div>


@code {
    [Parameter] public string? Sufix { get; set; } = "";
    [Parameter]
    public EventCallback<int> PassChosenStreamer { get; set; }
    [Parameter]
    public StreamerProfile[] StreamerProfile { get; set; } = new StreamerProfile[20];
    
    private bool _showList = false;
    
    private void UpdateItemsList(ChangeEventArgs e)
    {
        Sufix = e.Value == null ? "" : e.Value.ToString();

        foreach (var streamer in StreamerProfile)
        {
            if (streamer.Name.StartsWith(Sufix ?? "", StringComparison.OrdinalIgnoreCase))
            {
                streamer.IsVisible = true;
            }
            else
            {
                streamer.IsVisible = false;
            }

        }

        StateHasChanged();
    }

    private async Task OnKeyPress(KeyboardEventArgs e)
    {  
        if (e.Key == "Enter")
        {
            int foundId = FindStreamer(StreamerProfile, Sufix);
            if (foundId != -1)
            {
                foreach (var streamer in StreamerProfile)
                {    
                        streamer.IsVisible = false;
                }

                await OnClick(foundId);
            }
        }
    }
    
    private async Task OnClick(int id)
    {   
        await PassChosenStreamer.InvokeAsync(id);
        Sufix = "";
        
        StateHasChanged();  
    }
    
    private void ChangeListVisibility()
    {
        _showList = !_showList;
    }

    private void HideList()
    {
        _showList = false;
        StateHasChanged();
    }
    
}
